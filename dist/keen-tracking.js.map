{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./node_modules/keen-core/lib/utils/each.js","webpack:///./node_modules/keen-core/lib/utils/extend.js","webpack:///./node_modules/promise-polyfill/src/polyfill.js","webpack:///./lib/config-default.js","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/promise-polyfill/src/finally.js","webpack:///./node_modules/whatwg-fetch/fetch.js","webpack:///./node_modules/component-emitter/index.js","webpack:///./lib/index.js","webpack:///./lib/helpers/getDomNodePath.js","webpack:///./lib/helpers/getWindowProfile.js","webpack:///./lib/helpers/getScreenProfile.js","webpack:///./lib/utils/md5.js","webpack:///./lib/utils/deepExtend.js","webpack:///./lib/extend-events.js","webpack:///./lib/utils/localStorage.js","webpack:///./lib/utils/optOut.js","webpack:///./lib/utils/queue.js","webpack:///./node_modules/promise-polyfill/src/index.js","webpack:///./lib/utils/timer.js","webpack:///./lib/utils/serializeForm.js","webpack:///./node_modules/js-cookie/src/js.cookie.js","webpack:///./lib/utils/cookie.js","webpack:///./lib/helpers/getUniqueId.js","webpack:///./lib/helpers/getScrollState.js","webpack:///./lib/helpers/getDomNodeProfile.js","webpack:///./lib/helpers/getDomainName.js","webpack:///./lib/helpers/getDatetimeIndex.js","webpack:///./lib/helpers/getBrowserProfile.js","webpack:///./lib/browser-auto-tracking.js","webpack:///./lib/defer-events.js","webpack:///./lib/utils/cache-browser.js","webpack:///./lib/utils/unique.js","webpack:///./lib/constants.js","webpack:///./lib/utils/fetchRetry.js","webpack:///./node_modules/keen-core/lib/utils/base64.js","webpack:///./node_modules/process/browser.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./node_modules/timers-browserify/main.js","webpack:///./lib/record-events-browser.js","webpack:///./lib/utils/listener.js","webpack:///./node_modules/keen-core/lib/utils/serialize.js","webpack:///./node_modules/keen-core/lib/utils/parse-params.js","webpack:///./node_modules/keen-core/lib/index.js","webpack:///./lib/browser.js"],"names":["configDefault","queue","capacity","interval","retry","limit","initialDelay","retryOnResponseStatuses","unique","cache","dbName","dbCollectionName","dbCollectionKey","maxAge","KeenCore","helpers","prototype","observers","on","client","extensions","events","collections","config","respectDoNotTrack","doNotTrack","optOut","optedOut","recordDeferredEvents","writeKey","str","arguments","length","String","referrerPolicy","setGlobalProperties","props","log","version","pkg","getDomNodePath","el","nodeName","stack","parentNode","sibCount","sibIndex","i","childNodes","sib","hasAttribute","id","unshift","toLowerCase","slice","join","getWindowProfile","body","html","output","document","documentElement","window","innerHeight","offsetHeight","innerWidth","offsetWidth","Math","max","scrollHeight","clientHeight","screen","ratio","availHeight","parseFloat","toFixed","availWidth","getScreenProfile","keys","orientation","MD5","d","result","M","V","Y","X","_","m","f","r","charCodeAt","charAt","Array","fromCharCode","n","h","t","g","e","md5_ii","md5_hh","md5_gg","md5_ff","safe_add","md5_cmn","bit_rol","deepExtend","target","j","indexOf","push","prop","clone","undefined","input","JSON","parse","stringify","extendEvent","extendEvents","getExtendedEventBody","eventCollection","eventModifier","handleValidationError","call","emit","eventsModifier","message","modifierResult","lsTest","test","localStorage","setItem","removeItem","isLocalStorageAvailable","setOptOut","configQueue","timer","check","shouldFlushQueue","flush","pause","clearInterval","start","self","setInterval","num","count","value","clear","serializeForm","k_r_submitter","k_r_success_contrls","brackets","form","options","hash","serializer","hash_serializer","str_serialize","elements","radio_store","Object","create","element","ignoreTypes","type","disabled","name","key","val","checked","empty","selectOptions","isSelectedOptions","option","allowedEmpty","hasValue","selected","parse_keys","string","prefix","children","RegExp","match","exec","hash_assign","shift","between","isArray","_values","index","isNaN","matches","existing","replace","encodeURIComponent","cookie","expires","data","get","Cookies","getJSON","set","enabled","expire","daysUntilExpire","remove","obj","navigator","cookieEnabled","getUniqueId","crypto","getRandomValues","c","Uint8Array","toString","random","v","getScrollState","state","pixel","pixel_max","ratio_max","getScrollOffset","getWindowHeight","Number","getScrollableArea","pageYOffset","scrollTop","getDomNodeProfile","action","class","className","href","getElementProps","event_key","method","node_name","selector","text","title","x_position","offsetLeft","clientLeft","y_position","offsetTop","clientTop","getAttribute","getDomainName","extractHostname","url","hostname","split","domain","splitArr","arrLen","getDatetimeIndex","date","Date","getHours","parseInt","getDay","getDate","getMonth","getFullYear","getBrowserProfile","appCodeName","getDocumentDescription","language","appName","onLine","platform","userAgent","appVersion","querySelector","content","initAutoTrackingCore","lib","utils","extend","ignoreDisabledFormFields","ignoreFormFieldTypes","recordClicks","recordClicksPositionPointer","recordFormSubmits","recordPageViews","recordPageViewsOnExit","recordScrollState","shareUuidAcrossDomains","collectIpAddress","collectUuid","recordElementViews","catchError","disableCookies","requestType","now","allTimeOnSiteS","allTimeOnSiteMS","hidden","visibilityChange","msHidden","webkitHidden","handleVisibilityChange","getSecondsSinceDate","getMiliSecondsSinceDate","addEventListener","domainName","location","cookieDomain","uuid","initialReferrer","referrer","scrollState","listener","addons","ua_string","date_time","ip_address","ip","remove_ip_property","browserProfile","tracked_by","local_time_full","toISOString","user","page","description","scroll_state","time_on_page","time_on_page_ms","geo","user_agent","tech","profile","full","info","initial","time","local","utc","keen","timestamp","event","pointer","pageX","pageY","recordEvent","collection","catch","err","serializerOptions","fields","IntersectionObserver","elementViewsOptions","threshold","elementViewsCallback","observer","forEach","isIntersecting","querySelectorAll","observe","round","getTime","deferEvent","deferEvents","queueCapacity","queueInterval","eventBody","eventsHash","eventList","concat","clonedQueueConfig","clonedQueueEvents","recordEvents","res","console","indexedDBAvailable","cachingEnabled","db","cacheConfig","initializeIndexedDb","requestCacheConfig","Promise","resolve","reject","dbConnectionRequest","indexedDB","open","onerror","onupgradeneeded","objectStore","createObjectStore","keyPath","createIndex","onsuccess","saveToCache","configOptions","then","transactionSave","transaction","requestSave","add","expiryTime","getFromCache","transactionCleanUp","indexCleanUp","upperBoundOpenKeyRange","IDBKeyRange","upperBound","openCursor","cursor","transactionDelete","delete","continue","transactionIndex","responseFromCache","uniqueIds","isUnique","customCacheConfig","extendedEventBody","configCache","stringifiedEvent","hashingMethod","item","filter","alreadySentEvent","find","storage","REQUEST_ABORTED","retriesLimit","retryInitialDelay","retryOn","retriesCount","abortController","AbortController","promiseWithAbort","wrappedFetch","fetch","signal","response","status","error","code","DOMException","ABORT_ERR","Constants","setTimeout","abort","eventCollectionOrConfigObject","callback","useBeaconApi","configObject","clientConfig","event_collection","checkValidation","extendedEventsHash","isUniqueResult","created","Keen","send","sendBeacon","getRequestUrl","api_key","base64","encode","modified","getRequestUrlOkLength","getUrlMaxLength","sendFetch","mode","redirect","headers","connectionError","ok","json","error_code","responseJSON","statusText","eventsSavedSuccessfuly","checkEventsSavedSuccessfuly","responseKeys","notSavedEvents","map","success","projectId","img","createElement","loaded","onload","naturalHeight","naturalWidth","width","height","src","listenerCore","ctx","domListeners","fn","addListener","eventHandler","once","off","apply","survivors","handler","eventType","evt","srcElement","handlers","deferClickEvent","deferFormSubmit","attachEvent","elem","nodeList","anchor","timeout","targetAttr","cbResponse","defaultPrevented","returnValue","preventDefault","metaKey","submit","initAutoTracking","listenTo","listenerHash","keenGlobals","webpackKeenGlobals","getItem","extendLibrary","KeenTracking"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;ACnEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,YAAY;AACzB;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1BA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACTA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,CAAC;AACD;AACA;;;;;;;;;;;;;;ACvBO,IAAMA,wCAAgB;;AAE3B;AACA;AACAC,SAAO;AACLC,cAAU,IADL;AAELC,cAAU;AAFL,GAJoB;;AAS3B;AACAC,SAAO;AACLC,WAAO,EADF;AAELC,kBAAc,GAFT;AAGLC,6BAAyB,CACvB,GADuB,EAEvB,GAFuB,EAGvB,GAHuB,EAIvB,GAJuB,EAKvB,GALuB;AAHpB,GAVoB;;AAsB3BC,UAAQ,KAtBmB,EAsBZ;AACf;AACAC,SAAO;AACL;;;AAGAC,YAAQ,cAJH,EAImB;AACxBC,sBAAkB,QALb;AAMLC,qBAAiB,MANZ;;AAQL;;;AAGAC,YAAQ,KAAK,IAXR,CAWc;AAXd;AAxBoB,CAAtB;;kBAuCQb,a;;;;;;ACvCf;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;;;;;ACdA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,wCAAwC,mBAAmB;AAC3D;AACA;;AAEA;AACA;AACA,kCAAkC,oBAAoB;AACtD;AACA;;AAEA;AACA;AACA,wCAAwC,4BAA4B;AACpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,uDAAuD;AACvD,SAAS;AACT;AACA,SAAS;AACT,8EAA8E;AAC9E;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,8BAA8B,uBAAuB;AACrD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,uCAAuC,0BAA0B;AACjE;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,+BAA+B,0BAA0B,eAAe;AACxE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA,KAAK;AACL;AACA;AACA,CAAC;;;;;;;;;;;;;;AChdD;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,SAAS;AACpB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,MAAM;AACjB,YAAY;AACZ;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,2CAA2C,SAAS;AACpD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;;AClKA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;;;;;AAEAc,mBAASC,OAAT,GAAmBD,mBAASC,OAAT,IAAoB,EAAvC;AACAD,mBAASE,SAAT,CAAmBC,SAAnB,GAA+BH,mBAASG,SA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YAAW;AAClCD,SAAK9I,QAAL;AACA8I,SAAKN,KAAL;AACD,GAHY,EAGV,IAHU,CAAb;AAIA,SAAOM,IAAP;AACD,CARD;;AAUA,SAASL,gBAAT,CAA0BxG,KAA1B,EAAiC;AAC/B,MAAIA,MAAMlC,QAAN,GAAiB,CAAjB,IAAsBkC,MAAMjC,QAAN,IAAkBiC,MAAMb,MAAN,CAAapB,QAAzD,EAAmE;AACjE,WAAO,IAAP;AACD,GAFD,MAGK,IAAIiC,MAAMlC,QAAN,IAAkBkC,MAAMb,MAAN,CAAarB,QAAnC,EAA6C;AAChD,WAAO,IAAP;AACD;AACD,SAAO,KAAP;AACD,C;;;;;;;;AClED;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;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aP,eAAeG,YAA5B;AACD,GAlCwB,CAAzB;;AAoCAG,mBAAiBY,KAAjB,GAAyB,YAAM;AAC3Bd,oBAAgBc,KAAhB;AACH,GAFD;;AAIA,SAAOZ,gBAAP;AACD,C;;AArED;;AACA;;AAEA;;;;AACA;;;;;;AAiEC,C;;;;;;ACrED;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,wBAAwB;AACrD,qBAAqB,oCAAoC;AACzD;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,oCAAoC;AACpC,iCAAiC;AACjC;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;;;;;;AC7CA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;;AAErC;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;ACvLtC;AACA;;AAEA;AACA;AACA;;AAEA,uBAAuB;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,iBAAiB;AACtC;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,sBAAsB,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,C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A;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA,oBAAoB,SAAS,IAAI,KAAK;AACtC,oBAAoB,SAAS,IAAI,KAAK;AACtC,oBAAoB,SAAS,IAAI,KAAK;AACtC,oBAAoB,SAAS,IAAI,KAAK,eAAe,UAAU;AAC/D,oBAAoB,SAAS,IAAI,KAAK,eAAe,UAAU;AAC/D,oBAAoB,SAAS,IAAI,KAAK,eAAe,UAAU;AAC/D,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA,kDAAkD,SAAS,IAAI,KAAK;AACpE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B,YAAY;AAC1C;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA,CAAC,sIAAsI;;;;;;;;;;;;;;;;ACnOvI;;;;AACA;;;;AACA;;;;AACA;;AACA;;AAIA;;AAOA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA;AACA;AACA;AACA,sBAAOvf,gBAASE,SAAhB,EAA2B;AACzB4U,+CADyB;AAEzB2B;AAFyB,CAA3B;;AAKA,sBAAOzW,gBAASE,SAAhB,EAA2B;AACzB6V,qCADyB;AAEzBC,uCAFyB;AAGzBC,2CAHyB;AAIzBC,2CAJyB;AAKzBpV,yDALyB;AAMzB4G;AANyB,CAA3B;AAQA,sBAAO1H,gBAASE,SAAhB,EAA2B;AACzBuG,wCADyB;AAEzBC;AAFyB,CAA3B;;AAKA;AACA;AACA;AACA,IAAMqZ,mBAAmB,+CAAqB/f,eAArB,CAAzB;AACA,sBAAOA,gBAASE,SAAhB,EAA2B;AACzB6f;AADyB,CAA3B;;AAIA;AACA;AACA;AACA,sBAAO/f,gBAASC,OAAhB,EAAyB;AACvB4P,yDADuB;AAEvBT,sDAFuB;AAGvBR,6CAHuB;AAIvBlN,gDAJuB;AAKvB+L,yDALuB;AAMvB1J,sDANuB;AAOvB+I,gDAPuB;AAQvBR,uCARuB;AASvB5J;AATuB,CAAzB;;AAYA;AACA;AACA;AACA,IAAMmQ,WAAW,4BAAa7S,eAAb,CAAjB;AACA,sBAAOA,gBAAS0Q,KAAhB,EAAuB;AACrBlF,wBADqB;AAErB3F,oCAFqB;AAGrBgN,oBAHqB;AAIrBpK,6CAJqB;AAKrBb;AALqB,CAAvB;;AAQA5H,gBAASggB,QAAT,GAAoB,UAACC,YAAD,EAAkB;AACpC,sBAAKA,YAAL,EAAmB,UAAC5E,QAAD,EAAWzR,GAAX,EAAmB;AACpC,QAAIoF,QAAQpF,IAAIoF,KAAJ,CAAU,GAAV,CAAZ;AACA,QAAI6P,YAAY7P,MAAM,CAAN,CAAhB;AAAA,QACAd,WAAWc,MAAMxM,KAAN,CAAY,CAAZ,EAAewM,MAAM9N,MAArB,EAA6BuB,IAA7B,CAAkC,GAAlC,CADX;AAEA;AACA,WAAOoQ,SAAS3E,QAAT,EAAmB9N,EAAnB,CAAsBye,SAAtB,EAAiCxD,QAAjC,CAAP;AACD,GAND;AAOD,CARD;;AAUO,IAAI6E,oCAAc9Z,SAAlB;AACP,IAAI,OAAO+Z,kBAAP,KAA8B,WAAlC,EAA+C;AAC7C,UAFSD,WAET,iBAAcC,kBAAd;AACD;;AAED,IAAI1Y,yCAA2BH,aAAa8Y,OAAb,CAAqB,QAArB,CAA/B,EAA+D;AAC7DpgB,kBAASa,QAAT,GAAoB,IAApB;AACD;;AAED,IAAIuL,UAAUzL,UAAV,KAAyB,GAAzB,IACCyL,UAAUzL,UAAV,KAAyB,KAD9B,EACqC;AACnCX,kBAASW,UAAT,GAAsB,IAAtB;AACD;;AAEM,IAAMmb,sBAAO9b,gBAASqgB,aAAT,CAAuBrgB,eAAvB,CAAb,C,CAA+C;AAC/C,IAAMsgB,sCAAexE,IAArB;kBACQA,I","file":"keen-tracking.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 46);\n","module.exports = each;\n\nfunction each(o, cb, s){\n  var n;\n  if (!o){\n    return 0;\n  }\n  s = !s ? o : s;\n  if (o instanceof Array){\n    // Indexed arrays, needed for Safari\n    for (n=0; n<o.length; n++) {\n      if (cb.call(s, o[n], n, o) === false){\n        return 0;\n      }\n    }\n  } else {\n    // Hashtables\n    for (n in o){\n      if (o.hasOwnProperty(n)) {\n        if (cb.call(s, o[n], n, o) === false){\n          return 0;\n        }\n      }\n    }\n  }\n  return 1;\n}\n","module.exports = extend;\n\nfunction extend(target){\n  for (var i = 1; i < arguments.length; i++) {\n    for (var prop in arguments[i]){\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n","import Promise from './index';\nimport promiseFinally from './finally';\n\nvar globalNS = (function() {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  if (typeof global !== 'undefined') {\n    return global;\n  }\n  throw new Error('unable to locate global object');\n})();\n\nif (!globalNS.Promise) {\n  globalNS.Promise = Promise;\n} else if (!globalNS.Promise.prototype['finally']) {\n  globalNS.Promise.prototype['finally'] = promiseFinally;\n}\n","export const configDefault = {\n\n  // defer events - queue\n  // https://github.com/keen/keen-tracking.js/blob/master/docs/defer-events.md\n  queue: {\n    capacity: 5000,\n    interval: 15,\n  },\n\n  // connection problems - retry request\n  retry: {\n    limit: 10,\n    initialDelay: 200,\n    retryOnResponseStatuses: [\n      408,\n      500,\n      502,\n      503,\n      504\n    ]\n  },\n\n  unique: false, // record only unique events?\n  // if so - store unique events hashes to compare\n  cache: {\n    /*\n      storage: 'indexeddb', // uncomment for persistence\n    */\n    dbName: 'keenTracking', // indexedDB name\n    dbCollectionName: 'events',\n    dbCollectionKey: 'hash',\n\n    /*\n      hashingMethod: 'md5', // if undefined - store as stringified JSON\n    */\n    maxAge: 60 * 1000, // store for 1 minute\n  }\n}\n\nexport default configDefault;\n","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\r\n} catch (e) {\r\n\t// This works if the window reference is available\r\n\tif (typeof window === \"object\") g = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n","export default function(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n","(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ]\n\n    var isDataView = function(obj) {\n      return obj && DataView.prototype.isPrototypeOf(obj)\n    }\n\n    var isArrayBufferView = ArrayBuffer.isView || function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1])\n      }, this)\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var oldValue = this.map[name]\n    this.map[name] = oldValue ? oldValue+','+value : value\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name)\n    return this.has(name) ? this.map[name] : null\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value)\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this)\n      }\n    }\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsArrayBuffer(blob)\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    var promise = fileReaderReady(reader)\n    reader.readAsText(blob)\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf)\n    var chars = new Array(view.length)\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i])\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength)\n      view.set(new Uint8Array(buf))\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (!body) {\n        this._bodyText = ''\n      } else if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer)\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer])\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body)\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      }\n    }\n\n    this.text = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = String(input)\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, { body: this._bodyInit })\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers()\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        headers.append(key, value)\n      }\n    })\n    return headers\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status === undefined ? 200 : options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = 'statusText' in options ? options.statusText : 'OK'\n    this.headers = new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init)\n      var xhr = new XMLHttpRequest()\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        }\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n","\r\n/**\r\n * Expose `Emitter`.\r\n */\r\n\r\nif (typeof module !== 'undefined') {\r\n  module.exports = Emitter;\r\n}\r\n\r\n/**\r\n * Initialize a new `Emitter`.\r\n *\r\n * @api public\r\n */\r\n\r\nfunction Emitter(obj) {\r\n  if (obj) return mixin(obj);\r\n};\r\n\r\n/**\r\n * Mixin the emitter properties.\r\n *\r\n * @param {Object} obj\r\n * @return {Object}\r\n * @api private\r\n */\r\n\r\nfunction mixin(obj) {\r\n  for (var key in Emitter.prototype) {\r\n    obj[key] = Emitter.prototype[key];\r\n  }\r\n  return obj;\r\n}\r\n\r\n/**\r\n * Listen on the given `event` with `fn`.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.on =\r\nEmitter.prototype.addEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\r\n    .push(fn);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Adds an `event` listener that will be invoked a single\r\n * time then automatically removed.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.once = function(event, fn){\r\n  function on() {\r\n    this.off(event, on);\r\n    fn.apply(this, arguments);\r\n  }\r\n\r\n  on.fn = fn;\r\n  this.on(event, on);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Remove the given callback for `event` or all\r\n * registered callbacks.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.off =\r\nEmitter.prototype.removeListener =\r\nEmitter.prototype.removeAllListeners =\r\nEmitter.prototype.removeEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n\r\n  // all\r\n  if (0 == arguments.length) {\r\n    this._callbacks = {};\r\n    return this;\r\n  }\r\n\r\n  // specific event\r\n  var callbacks = this._callbacks['$' + event];\r\n  if (!callbacks) return this;\r\n\r\n  // remove all handlers\r\n  if (1 == arguments.length) {\r\n    delete this._callbacks['$' + event];\r\n    return this;\r\n  }\r\n\r\n  // remove specific handler\r\n  var cb;\r\n  for (var i = 0; i < callbacks.length; i++) {\r\n    cb = callbacks[i];\r\n    if (cb === fn || cb.fn === fn) {\r\n      callbacks.splice(i, 1);\r\n      break;\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * Emit `event` with the given args.\r\n *\r\n * @param {String} event\r\n * @param {Mixed} ...\r\n * @return {Emitter}\r\n */\r\n\r\nEmitter.prototype.emit = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n  var args = [].slice.call(arguments, 1)\r\n    , callbacks = this._callbacks['$' + event];\r\n\r\n  if (callbacks) {\r\n    callbacks = callbacks.slice(0);\r\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n      callbacks[i].apply(this, args);\r\n    }\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Return array of callbacks for `event`.\r\n *\r\n * @param {String} event\r\n * @return {Array}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.listeners = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n  return this._callbacks['$' + event] || [];\r\n};\r\n\r\n/**\r\n * Check if this emitter has `event` handlers.\r\n *\r\n * @param {String} event\r\n * @return {Boolean}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.hasListeners = function(event){\r\n  return !! this.listeners(event).length;\r\n};\r\n","import KeenCore from 'keen-core';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport { queue } from './utils/queue';\nimport { setOptOut } from './utils/optOut';\nimport pkg from '../package.json';\n\nKeenCore.helpers = KeenCore.helpers || {};\nKeenCore.prototype.observers = KeenCore.observers || {};\n\n// Install internal queue\nKeenCore.on('client', function(client){\n  client.extensions = {\n    events: [],\n    collections: {}\n  };\n\n  if (!client.config.respectDoNotTrack) {\n    this.doNotTrack = false;\n  }\n\n  if (typeof client.config.optOut !== 'undefined') {\n    setOptOut(client.config.optOut);\n    this.optedOut = client.config.optOut;\n  }\n\n  client.queue = queue(client.config.queue);\n  client.queue.on('flush', function(){\n    client.recordDeferredEvents();\n  });\n});\n\n// Accessors\nKeenCore.prototype.writeKey = function(str){\n  if (!arguments.length) return this.config.writeKey;\n  this.config.writeKey = (str ? String(str) : null);\n  return this;\n};\n\nKeenCore.prototype.referrerPolicy = function(str){\n  if (!arguments.length) return this.config.referrerPolicy;\n  this.config.referrerPolicy = (str ? String(str) : null);\n  return this;\n};\n\n// DEPRECATED\nKeenCore.prototype.setGlobalProperties = function(props){\n  KeenCore.log('This method has been removed. Check out #extendEvents: https://github.com/keen/keen-tracking.js#extend-events');\n  return this;\n};\n\nKeenCore.version = pkg.version;\n\nexport default KeenCore;\n","export function getDomNodePath(el){\n  if (!el.nodeName) return '';\n\n  var stack = [];\n  while ( el.parentNode != null ) {\n    // console.log(el.nodeName);\n    var sibCount = 0;\n    var sibIndex = 0;\n    for ( var i = 0; i < el.parentNode.childNodes.length; i++ ) {\n      var sib = el.parentNode.childNodes[i];\n      if ( sib.nodeName == el.nodeName ) {\n        if ( sib === el ) {\n          sibIndex = sibCount;\n        }\n        sibCount++;\n      }\n    }\n    if ( el.hasAttribute('id') && el.id != '' ) {\n      stack.unshift(el.nodeName.toLowerCase() + '#' + el.id);\n    } else if ( sibCount > 1 ) {\n      stack.unshift(el.nodeName.toLowerCase() + ':eq(' + sibIndex + ')');\n    } else {\n      stack.unshift(el.nodeName.toLowerCase());\n    }\n    el = el.parentNode;\n  }\n\n  return stack.slice(1).join(' > ');\n}\n\n\n// via: http://stackoverflow.com/a/16742828/2511985\n","export function getWindowProfile(){\n  var body, html, output;\n\n  if ('undefined' == typeof document) return {};\n\n  body = document.body || {};\n  html = document.documentElement || {};\n\n  output = {\n    'height': ('innerHeight' in window) ? window.innerHeight : document.documentElement.offsetHeight,\n    'width': ('innerWidth' in window) ? window.innerWidth : document.documentElement.offsetWidth,\n    'scrollHeight': Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ) || null\n  };\n\n  if (window.screen) {\n    output.ratio = {\n      'height': (window.screen.availHeight) ? parseFloat( (window.innerHeight/window.screen.availHeight).toFixed(2) ) : null,\n      'width': (window.screen.availWidth) ? parseFloat( (window.innerWidth/window.screen.availWidth).toFixed(2) ) : null\n    };\n  }\n\n  return output;\n}\n\n/*\n  Notes:\n    document.documentElement.offsetHeight/Width is a workaround for IE8 and below, where window.innerHeight/Width is undefined\n*/\n","export function getScreenProfile(){\n  var keys, output;\n\n  if ('undefined' == typeof window || !window.screen) return {};\n\n  keys = ['height', 'width', 'colorDepth', 'pixelDepth', 'availHeight', 'availWidth'];\n  output = {};\n\n  for (var i = 0; i < keys.length; i++) {\n    output[keys[i]] = window.screen[keys[i]] ? window.screen[keys[i]] : null;\n  }\n\n  output.orientation = {\n    'angle' : window.screen.orientation ? window.screen.orientation['angle'] : 0,\n    'type'  : window.innerWidth > window.innerHeight ? 'landscape': 'portrait'\n  };\n\n  return output;\n}\n","export const MD5 = function(d){const result = M(V(Y(X(d),8*d.length)));return result.toLowerCase()};function M(d){for(var _,m=\"0123456789ABCDEF\",f=\"\",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _=\"\",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}\n\nexport default MD5;\n","export const deepExtend = function(target){\n  for (var i = 1; i < arguments.length; i++) {\n    // Copy unique items from incoming array\n    if (target instanceof Array && arguments[i] instanceof Array) {\n      for (var j = 0; j < arguments[i].length; j++) {\n        if (target.indexOf(arguments[i][j]) < 0) {\n          target.push(arguments[i][j]);\n        }\n      }\n    }\n    // Blend objects\n    else {\n      for (var prop in arguments[i]){\n        // Recurse when both contain objects of same name\n        // and incoming is not a null object\n        if (typeof target[prop] !== 'undefined'\n          && typeof target[prop] === 'object'\n          && typeof arguments[i][prop] === 'object'\n          && arguments[i][prop] !== null) {\n            deepExtend(target[prop], clone(arguments[i][prop]));\n        }\n        // Otherwise just copy it over...\n        else if (\n          arguments[i][prop] !== undefined &&\n          typeof arguments[i][prop] !== 'function') {\n            target[prop] = clone(arguments[i][prop]);\n        }\n      }\n    }\n  }\n  return target;\n}\n\nfunction clone(input){\n  return JSON.parse( JSON.stringify(input) );\n}\n","import { deepExtend } from './utils/deepExtend';\nimport each from 'keen-core/lib/utils/each';\n\nexport function extendEvent(eventCollection, eventModifier){\n  if (arguments.length !== 2 || typeof eventCollection !== 'string'\n    || ('object' !== typeof eventModifier && 'function' !== typeof eventModifier)) {\n      handleValidationError.call(this, 'Incorrect arguments provided to #extendEvent method');\n      return;\n  }\n  this.extensions.collections[eventCollection] = this.extensions.collections[eventCollection] || [];\n  this.extensions.collections[eventCollection].push(eventModifier);\n  this.emit('extendEvent', eventCollection, eventModifier);\n  return this;\n}\n\nexport function extendEvents(eventsModifier){\n  if (arguments.length !== 1 || ('object' !== typeof eventsModifier && 'function' !== typeof eventsModifier)) {\n    handleValidationError.call(this, 'Incorrect arguments provided to #extendEvents method');\n    return;\n  }\n  this.extensions.events.push(eventsModifier);\n  this.emit('extendEvents', eventsModifier);\n  return this;\n}\n\nfunction handleValidationError(message){\n  this.emit('error', `Event(s) not extended: ${message}`);\n}\n\nexport function getExtendedEventBody(result, queue){\n  if (queue && queue.length > 0) {\n    each(queue, function(eventModifier, i){\n      let modifierResult = (typeof eventModifier === 'function') ? eventModifier() : eventModifier;\n      deepExtend(result, modifierResult);\n    });\n  }\n  return result;\n}\n","function lsTest(){\n  const test = 'test';\n  try {\n      localStorage.setItem(test, test);\n      localStorage.removeItem(test);\n      return true;\n  } catch(e) {\n      return false;\n  }\n}\n\nexport const isLocalStorageAvailable = lsTest();","import { isLocalStorageAvailable } from './localStorage';\n\nexport function setOptOut(optOut = true) {\n    if (!isLocalStorageAvailable) return;\n\n    if (optOut) {\n        localStorage.setItem('optout', optOut);\n        return;\n    }\n\n    localStorage.removeItem('optout');\n};\n","import Emitter from 'component-emitter';\n\nimport configDefault from '../config-default.js';\n\nexport function queue(configQueue = {}) {\n  if (this instanceof queue === false) {\n    return new queue(configQueue);\n  }\n  this.capacity = 0;\n  this.config = {\n    ...configDefault.queue,\n    ...configQueue\n  };\n  this.events = {\n    // \"collection-1\": [],\n    // \"collection-2\": []\n  };\n  this.interval = 0;\n  this.timer = null;\n  return this;\n}\n\nEmitter(queue.prototype);\n\nqueue.prototype.check = function() {\n  if (shouldFlushQueue(this)) {\n    this.flush();\n  }\n  if (this.config.interval === 0 || this.capacity === 0) {\n    this.pause();\n  }\n  return this;\n};\n\nqueue.prototype.flush = function() {\n  this.emit('flush');\n  this.interval = 0;\n  return this;\n};\n\nqueue.prototype.pause = function() {\n  if (this.timer) {\n    clearInterval(this.timer);\n    this.timer = null;\n  }\n  return this;\n};\n\nqueue.prototype.start = function() {\n  var self = this;\n  self.pause();\n  self.timer = setInterval(function() {\n    self.interval++;\n    self.check();\n  }, 1000);\n  return self;\n};\n\nfunction shouldFlushQueue(props) {\n  if (props.capacity > 0 && props.interval >= props.config.interval) {\n    return true;\n  }\n  else if (props.capacity >= props.config.capacity) {\n    return true;\n  }\n  return false;\n}\n","import promiseFinally from './finally';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  this._state = 0;\n  this._handled = false;\n  this._value = undefined;\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!arr || typeof arr.length === 'undefined')\n      throw new TypeError('Promise.all accepts an array');\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(values) {\n  return new Promise(function(resolve, reject) {\n    for (var i = 0, len = values.length; i < len; i++) {\n      values[i].then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","export function timer(num){\n  if (this instanceof timer === false) {\n    return new timer(num);\n  }\n  this.count = num || 0;\n  return this;\n}\n\ntimer.prototype.start = function(){\n  var self = this;\n  this.pause();\n  this.interval = setInterval(function(){\n    self.count++;\n  }, 1000);\n  return this;\n};\n\ntimer.prototype.pause = function(){\n  clearInterval(this.interval);\n  return this;\n};\n\ntimer.prototype.value = function(){\n  return this.count;\n};\n\ntimer.prototype.clear = function(){\n  this.count = 0;\n  return this;\n};\n","/*\n  This is a modified copy of https://github.com/defunctzombie/form-serialize/ v0.7.1\n  Includes a new configuration option:\n    * ignoreTypes - Array, Default: [], Example: [ 'password' ]\n*/\n\n// types which indicate a submit action and are not successful controls\n// these will be ignored\nvar k_r_submitter = /^(?:submit|button|image|reset|file)$/i;\n\n// node names which could be successful controls\nvar k_r_success_contrls = /^(?:input|select|textarea|keygen)/i;\n\n// Matches bracket notation.\nvar brackets = /(\\[[^\\[\\]]*\\])/g;\n\n// serializes form fields\n// @param form MUST be an HTMLForm element\n// @param options is an optional argument to configure the serialization. Default output\n// with no options specified is a url encoded string\n//    - hash: [true | false] Configure the output type. If true, the output will\n//    be a js object.\n//    - serializer: [function] Optional serializer function to override the default one.\n//    The function takes 3 arguments (result, key, value) and should return new result\n//    hash and url encoded str serializers are provided with this module\n//    - disabled: [true | false]. If true serialize disabled fields.\n//    - empty: [true | false]. If true serialize empty fields\nexport function serializeForm(form, options) {\n  if (typeof options != 'object') {\n    options = { hash: !!options };\n  }\n  else if (options.hash === undefined) {\n    options.hash = true;\n  }\n\n  var result = (options.hash) ? {} : '';\n  var serializer = options.serializer || ((options.hash) ? hash_serializer : str_serialize);\n\n  var elements = form && form.elements ? form.elements : [];\n\n  // Object store each radio and set if it's empty or not\n  var radio_store = Object.create(null);\n\n  for (var i=0 ; i<elements.length ; ++i) {\n    var element = elements[i];\n\n    // NEW: Skip ignored field types\n    if (options.ignoreTypes && options.ignoreTypes.indexOf(element.type) > -1) {\n      continue;\n    }\n    // ingore disabled fields\n    if ((!options.disabled && element.disabled) || !element.name) {\n      continue;\n    }\n    // ignore anyhting that is not considered a success field\n    if (!k_r_success_contrls.test(element.nodeName) ||\n      k_r_submitter.test(element.type)) {\n      continue;\n    }\n\n    var key = element.name;\n    var val = element.value;\n\n    // we can't just use element.value for checkboxes cause some browsers lie to us\n    // they say \"on\" for value when the box isn't checked\n    if ((element.type === 'checkbox' || element.type === 'radio') && !element.checked) {\n      val = undefined;\n    }\n\n    // If we want empty elements\n    if (options.empty) {\n      if (element.type === 'checkbox' && !element.checked) {\n        val = '';\n      }\n\n      // for radio\n      if (element.type === 'radio') {\n        if (!radio_store[element.name] && !element.checked) {\n          radio_store[element.name] = false;\n        }\n        else if (element.checked) {\n          radio_store[element.name] = true;\n        }\n      }\n\n      // if options empty is true, continue only if its radio\n      if (val == undefined && element.type == 'radio') {\n        continue;\n      }\n    }\n    else {\n      // value-less fields are ignored unless options.empty is true\n      if (!val) {\n        continue;\n      }\n    }\n\n    // multi select boxes\n    if (element.type === 'select-multiple') {\n      val = [];\n\n      var selectOptions = element.options;\n      var isSelectedOptions = false;\n      for (var j=0 ; j<selectOptions.length ; ++j) {\n        var option = selectOptions[j];\n        var allowedEmpty = options.empty && !option.value;\n        var hasValue = (option.value || allowedEmpty);\n        if (option.selected && hasValue) {\n          isSelectedOptions = true;\n\n          // If using a hash serializer be sure to add the\n          // correct notation for an array in the multi-select\n          // context. Here the name attribute on the select element\n          // might be missing the trailing bracket pair. Both names\n          // \"foo\" and \"foo[]\" should be arrays.\n          if (options.hash && key.slice(key.length - 2) !== '[]') {\n            result = serializer(result, key + '[]', option.value);\n          }\n          else {\n            result = serializer(result, key, option.value);\n          }\n        }\n      }\n\n      if (!isSelectedOptions && options.empty) {\n        result = serializer(result, key, '');\n      }\n      continue;\n    }\n\n    result = serializer(result, key, val);\n  }\n\n  if (options.empty) {\n    for (var key in radio_store) {\n      if (!radio_store[key]) {\n        result = serializer(result, key, '');\n      }\n    }\n  }\n\n  return result;\n}\n\nfunction parse_keys(string) {\n  var keys = [];\n  var prefix = /^([^\\[\\]]*)/;\n  var children = new RegExp(brackets);\n  var match = prefix.exec(string);\n\n  if (match[1]) {\n      keys.push(match[1]);\n  }\n\n  while ((match = children.exec(string)) !== null) {\n      keys.push(match[1]);\n  }\n\n  return keys;\n}\n\nfunction hash_assign(result, keys, value) {\n  if (keys.length === 0) {\n    result = value;\n    return result;\n  }\n\n  var key = keys.shift();\n  var between = key.match(/^\\[(.+?)\\]$/);\n\n  if (key === '[]') {\n    result = result || [];\n\n    if (Array.isArray(result)) {\n      result.push(hash_assign(null, keys, value));\n    }\n    else {\n      // This might be the result of bad name attributes like \"[][foo]\",\n      // in this case the original `result` object will already be\n      // assigned to an object literal. Rather than coerce the object to\n      // an array, or cause an exception the attribute \"_values\" is\n      // assigned as an array.\n      result._values = result._values || [];\n      result._values.push(hash_assign(null, keys, value));\n    }\n\n    return result;\n  }\n\n  // Key is an attribute name and can be assigned directly.\n  if (!between) {\n    result[key] = hash_assign(result[key], keys, value);\n  }\n  else {\n    var string = between[1];\n    // +var converts the variable into a number\n    // better than parseInt because it doesn't truncate away trailing\n    // letters and actually fails if whole thing is not a number\n    var index = +string;\n\n    // If the characters between the brackets is not a number it is an\n    // attribute name and can be assigned directly.\n    if (isNaN(index)) {\n      result = result || {};\n      result[string] = hash_assign(result[string], keys, value);\n    }\n    else {\n      result = result || [];\n      result[index] = hash_assign(result[index], keys, value);\n    }\n  }\n\n  return result;\n}\n\n// Object/hash encoding serializer.\nfunction hash_serializer(result, key, value) {\n  var matches = key.match(brackets);\n\n  // Has brackets? Use the recursive assignment function to walk the keys,\n  // construct any missing objects in the result tree and make the assignment\n  // at the end of the chain.\n  if (matches) {\n    var keys = parse_keys(key);\n    hash_assign(result, keys, value);\n  }\n  else {\n    // Non bracket notation can make assignments directly.\n    var existing = result[key];\n\n    // If the value has been assigned already (for instance when a radio and\n    // a checkbox have the same name attribute) convert the previous value\n    // into an array before pushing into it.\n    //\n    // NOTE: If this requirement were removed all hash creation and\n    // assignment could go through `hash_assign`.\n    if (existing) {\n      if (!Array.isArray(existing)) {\n        result[key] = [ existing ];\n      }\n\n      result[key].push(value);\n    }\n    else {\n      result[key] = value;\n    }\n  }\n\n  return result;\n}\n\n// urlform encoding serializer\nfunction str_serialize(result, key, value) {\n  // encode newlines as \\r\\n cause the html spec says so\n  value = value.replace(/(\\r)?\\n/g, '\\r\\n');\n  value = encodeURIComponent(value);\n\n  // spaces should be '+' rather than '%20'.\n  value = value.replace(/%20/g, '+');\n  return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + value;\n}\n","/*!\n * JavaScript Cookie v2.1.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n(function (factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t} else if (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t} else {\n\t\tvar _OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = _OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\treturn (document.cookie = [\n\t\t\t\t\tkey, '=', value,\n\t\t\t\t\tattributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE\n\t\t\t\t\tattributes.path    && '; path=' + attributes.path,\n\t\t\t\t\tattributes.domain  && '; domain=' + attributes.domain,\n\t\t\t\t\tattributes.secure ? '; secure' : ''\n\t\t\t\t].join(''));\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.get = api.set = api;\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","import Cookies from 'js-cookie';\nimport extend from 'keen-core/lib/utils/extend';\n\nexport const cookie = function(str){\n  if (!arguments.length) return;\n  if (this instanceof cookie === false) {\n    return new cookie(str);\n  }\n\n  this.config = {\n    key: str,\n    options: {\n      expires: 365\n    }\n  };\n  this.data = this.get();\n  return this;\n}\n\ncookie.prototype.get = function(str){\n  var data = {};\n\n  if (Cookies.get(this.config.key)) {\n    data = Cookies.getJSON(this.config.key);\n  }\n  if (str && typeof data === 'object' && typeof data !== null) {\n    return (typeof data[str] !== 'undefined') ? data[str] : null;\n  }\n  else {\n    return data;\n  }\n};\n\ncookie.prototype.set = function(str, value, options){\n  if (!arguments.length || !this.enabled()) return this;\n  if (typeof str === 'string' && arguments.length >= 2) {\n    this.data[str] = value ? value : null;\n  }\n  else if (typeof str === 'object' && arguments.length === 1) {\n    extend(this.data, str);\n  }\n  Cookies.set(\n    this.config.key,\n    this.data,\n    extend(this.config.options, options || {})\n  );\n  return this;\n};\n\ncookie.prototype.expire = function(daysUntilExpire){\n  if (daysUntilExpire) {\n    Cookies.set(\n      this.config.key,\n      this.data,\n      extend(this.config.options, { expires: daysUntilExpire })\n    );\n  } else {\n    Cookies.remove(this.config.key);\n    this.data = {};\n  }\n  return this;\n};\n\ncookie.prototype.options = function(obj){\n  if (!arguments.length) return this.config.options;\n  this.config.options = (typeof obj === 'object') ? obj : {};\n  return this;\n};\n\ncookie.prototype.enabled = function(){\n  return navigator.cookieEnabled;\n};\n","export function getUniqueId() {\n  // uuidv4\n  if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\n    // browser\n    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    )\n  } else {\n    // node & older browsers\n    let str = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n    return str.replace(/[xy]/g, function(c) {\n      let r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);\n      return v.toString(16);\n    });\n  }\n}\n","import extend from 'keen-core/lib/utils/extend';\n\nexport function getScrollState(obj){\n  var config = typeof obj === 'object' ? obj : {};\n  var state = extend({\n    pixel: 0,\n    pixel_max: 0,\n    ratio: null,\n    ratio_max: null\n  }, config);\n\n  if (typeof window !== undefined || typeof document !== undefined) {\n    state.pixel = getScrollOffset() + getWindowHeight();\n    if (state.pixel > state.pixel_max) {\n      state.pixel_max = state.pixel;\n    }\n    state.ratio = parseFloat(Number(state.pixel / getScrollableArea()).toFixed(2));\n    state.ratio_max = parseFloat(Number(state.pixel_max / getScrollableArea()).toFixed(2));\n  }\n\n  return state;\n}\n\nfunction getScrollableArea() {\n  var body = document.body;\n  var html = document.documentElement;\n  return Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ) || null;\n}\n\nfunction getScrollOffset() {\n  return (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;\n}\n\nfunction getWindowHeight() {\n  return window.innerHeight || document.documentElement.clientHeight;\n}\n","import { getDomNodePath } from './getDomNodePath';\n\nexport function getDomNodeProfile(el) {\n  return {\n    action: el.action,\n    class: el.className,\n    href: getElementProps(el, 'href'),\n    id: getElementProps(el, 'id'),\n    event_key: getElementProps(el, 'data-event-key'),\n    method: el.method,\n    name: el.name,\n    node_name: el.nodeName,\n    selector: getDomNodePath(el),\n    text: getElementProps(el, 'text'),\n    title: getElementProps(el, 'title'),\n    type: el.type,\n    x_position: el.offsetLeft || el.clientLeft || null,\n    y_position: el.offsetTop || el.clientTop || null\n  };\n}\n\nconst getElementProps = (el, prop) => {\n  if (el[prop]) {\n    return el[prop];\n  }\n  if (el.hasAttribute && el.hasAttribute(prop)) {\n    return el.getAttribute(prop);\n  }\n  if (el.parentNode) {\n    return getElementProps(el.parentNode, prop);\n  }\n  return null;\n};\n","function extractHostname(url) {\n    var hostname;\n    //find & remove protocol (http, ftp, etc.) and get hostname\n\n    if (url.indexOf(\"://\") > -1) {\n        hostname = url.split('/')[2];\n    }\n    else {\n        hostname = url.split('/')[0];\n    }\n\n    //find & remove port number\n    hostname = hostname.split(':')[0];\n    //find & remove \"?\"\n    hostname = hostname.split('?')[0];\n\n    return hostname;\n}\n\n// To address those who want the \"root domain,\" use this function:\nexport function getDomainName(url) {\n    var domain = extractHostname(url),\n        splitArr = domain.split('.'),\n        arrLen = splitArr.length;\n\n    //extracting the root domain here\n    //if there is a subdomain\n    if (arrLen > 2) {\n        domain = splitArr[arrLen - 2] + '.' + splitArr[arrLen - 1];\n        //check to see if it's using a Country Code Top Level Domain (ccTLD) (i.e. \".me.uk\")\n        if (splitArr[arrLen - 2].length == 2 && splitArr[arrLen - 1].length == 2) {\n            //this is using a ccTLD\n            domain = splitArr[arrLen - 3] + '.' + domain;\n        }\n    }\n    return domain;\n}\n","export function getDatetimeIndex(input){\n  var date = input || new Date();\n  return {\n    'hour_of_day'  : date.getHours(),\n    'day_of_week'  : parseInt( 1 + date.getDay() ),\n    'day_of_month' : date.getDate(),\n    'month'        : parseInt( 1 + date.getMonth() ),\n    'year'         : date.getFullYear()\n  };\n}\n","import { getScreenProfile } from './getScreenProfile';\nimport { getWindowProfile } from './getWindowProfile';\n\nexport function getBrowserProfile() {\n  return {\n    'cookies'    : ('undefined' !== typeof navigator.cookieEnabled) ? navigator.cookieEnabled : false,\n    'codeName'   : navigator.appCodeName,\n    'description': getDocumentDescription(),\n    'language'   : navigator.language,\n    'name'       : navigator.appName,\n    'online'     : navigator.onLine,\n    'platform'   : navigator.platform,\n    'useragent'  : navigator.userAgent,\n    'version'    : navigator.appVersion,\n    'doNotTrack' : navigator.doNotTrack,\n    'screen'     : getScreenProfile(),\n    'window'     : getWindowProfile()\n  }\n}\n\nfunction getDocumentDescription() {\n  var el;\n  if (document && typeof document.querySelector === 'function') {\n    el = document.querySelector('meta[name=\"description\"]');\n  }\n  return el ? el.content : '';\n}\n","import pkg from '../package.json';\n\nexport function initAutoTrackingCore(lib) {\n  return function(obj) {\n    const client = this;\n    const helpers = lib.helpers;\n    const utils = lib.utils;\n\n    const options = utils.extend({\n      ignoreDisabledFormFields: false,\n      ignoreFormFieldTypes: ['password'],\n      recordClicks: true,\n      recordClicksPositionPointer: false,\n      recordFormSubmits: true,\n      recordPageViews: true,\n      recordPageViewsOnExit: false,\n      recordScrollState: true,\n      shareUuidAcrossDomains: false,\n      collectIpAddress: true,\n      collectUuid: true,\n      recordElementViews: true,\n      catchError: undefined, // optional, function(someError) - error handler\n      disableCookies: false,\n    }, obj);\n\n    if (client.config.requestType === 'beaconAPI' && options.catchError) {\n      throw `You cannot use the BeaconAPI and catchError function in the same time, because BeaconAPI ignores errors. For requests with error handling - use requestType: 'fetch'`;\n      return;\n    }\n\n    if (\n      client.config.requestType === 'jsonp' // jsonp is deprecated, it's the default value from old keen's client\n    ) {\n      if (options.catchError) {\n        client.config.requestType = 'fetch';\n      } else {\n        client.config.requestType = 'beaconAPI';\n      }\n    }\n\n    let now = new Date();\n    let allTimeOnSiteS = 0;\n    let allTimeOnSiteMS = 0;\n    if(typeof document !== 'undefined') {\n      let hidden;\n      let visibilityChange;\n      if (typeof document.hidden !== \"undefined\") {\n        hidden = \"hidden\";\n        visibilityChange = \"visibilitychange\";\n      } else if (typeof document.msHidden !== \"undefined\") {\n        hidden = \"msHidden\";\n        visibilityChange = \"msvisibilitychange\";\n      } else if (typeof document.webkitHidden !== \"undefined\") {\n        hidden = \"webkitHidden\";\n        visibilityChange = \"webkitvisibilitychange\";\n      }\n\n      const handleVisibilityChange = () => {\n        if(document[hidden]) {\n          allTimeOnSiteS += getSecondsSinceDate(now);\n          allTimeOnSiteMS += getMiliSecondsSinceDate(now);\n          return;\n        } \n        now = new Date();\n      }\n      if(typeof document.addEventListener !== \"undefined\" ||\n         hidden !== undefined){\n        document.addEventListener(visibilityChange, handleVisibilityChange, false);\n      }\n    }\n\n    let cookie;\n    if (!options.disableCookies) {\n      cookie = new utils.cookie('keen');\n    }\n\n    const domainName = helpers.getDomainName(window.location.hostname);\n    const cookieDomain = domainName && options.shareUuidAcrossDomains ? {\n      domain: '.' + domainName\n    } : {};\n\n    let uuid;\n    if (options.collectUuid) {\n      if (!options.disableCookies) {\n        uuid = cookie.get('uuid');\n      }\n      if (!uuid) {\n        uuid = helpers.getUniqueId();\n        if (!options.disableCookies) {  // if cookies disabled, uuid will not persist across page reloads or subsequent visits\n          cookie.set('uuid', uuid, cookieDomain);\n        }\n      }\n    }\n\n    let initialReferrer;\n    if (!options.disableCookies) {\n      initialReferrer = cookie.get('initialReferrer');\n    }\n    if (!initialReferrer) {\n      initialReferrer = document && document.referrer || undefined;\n      if (!options.disableCookies) {\n        cookie.set('initialReferrer', initialReferrer, cookieDomain);\n      }\n    }\n\n    let scrollState = {};\n    if (options.recordScrollState) {\n      scrollState = helpers.getScrollState();\n      utils.listener('window').on('scroll', () => {\n        scrollState = helpers.getScrollState(scrollState);\n      });\n    }\n\n    const addons = [\n      {\n        name: 'keen:ua_parser',\n        input: {\n          ua_string: 'user_agent'\n        },\n        output: 'tech'\n      },\n      {\n        name: 'keen:url_parser',\n        input: {\n          url: 'url.full'\n        },\n        output: 'url.info'\n      },\n      {\n        name: 'keen:url_parser',\n        input: {\n          url: 'referrer.full'\n        },\n        output: 'referrer.info'\n      },\n      {\n        name: 'keen:date_time_parser',\n        input: {\n          date_time: 'keen.timestamp'\n        },\n        output: 'time.utc'\n      },\n      {\n        name: 'keen:date_time_parser',\n        input: {\n          date_time: 'local_time_full'\n        },\n        output: 'time.local'\n      }\n    ];\n\n    let ip_address = '${keen.ip}';\n    addons.push({\n      name: 'keen:ip_to_geo',\n      input: {\n        ip: 'ip_address',\n        remove_ip_property: !options.collectIpAddress\n      },\n      output : 'geo'\n    });\n\n    client.extendEvents(function() {\n      const browserProfile = helpers.getBrowserProfile();\n      return {\n        tracked_by: pkg.name + '-' + pkg.version,\n        local_time_full: new Date().toISOString(),\n        user: {\n          uuid\n        },\n        page: {\n          title: document ? document.title : null,\n          description: browserProfile.description,\n          scroll_state: scrollState,\n          time_on_page: allTimeOnSiteS > 0 ? allTimeOnSiteS : getSecondsSinceDate(now),\n          time_on_page_ms: allTimeOnSiteMS > 0 ? allTimeOnSiteMS : getMiliSecondsSinceDate(now)\n        },\n\n        ip_address,\n        geo: { /* Enriched */ },\n\n        user_agent: '${keen.user_agent}',\n        tech: {\n          profile: browserProfile\n          /* Enriched */\n        },\n\n        url: {\n          full: window ? window.location.href : '',\n          info: { /* Enriched */ }\n        },\n\n        referrer: {\n          initial: initialReferrer,\n          full: document ? document.referrer : '',\n          info: { /* Enriched */ }\n        },\n\n        time: {\n          local: { /* Enriched */ },\n          utc: { /* Enriched */ }\n        },\n\n        keen: {\n          timestamp: new Date().toISOString(),\n          addons,\n        }\n      };\n    });\n\n    if (options.recordClicks === true) {\n      utils.listener('a, a *').on('click', function(e) {\n        const el = e.target;\n        let event = {\n          element: helpers.getDomNodeProfile(el),\n          local_time_full: new Date().toISOString(),\n        };\n\n        // pointer position tracking\n        if(options.recordClicksPositionPointer === true) {\n          const pointer = {\n            x_position: e.pageX,\n            y_position: e.pageY,\n          }\n          event = {...event, pointer};\n        }\n\n        if (options.catchError) {\n          return client\n            .recordEvent({\n              collection: 'clicks',\n              event\n            }).catch(err => {\n              options.catchError(err);\n            });\n        }\n\n        return client\n          .recordEvent({\n            collection: 'clicks',\n            event\n          });\n      });\n    }\n\n    if (options.recordFormSubmits === true) {\n      utils.listener('form').on('submit', function(e) {\n        const el = e.target;\n        const serializerOptions = {\n          disabled: options.ignoreDisabledFormFields,\n          ignoreTypes: options.ignoreFormFieldTypes\n        };\n        const event = {\n          form: {\n            action: el.action,\n            fields: utils.serializeForm(el, serializerOptions),\n            method: el.method\n          },\n          element: helpers.getDomNodeProfile(el),\n          local_time_full: new Date().toISOString()\n        };\n\n        if (options.catchError) {\n          return client\n            .recordEvent({\n              collection: 'form_submissions',\n              event\n            })\n            .catch(err => {\n              options.catchError(err);\n            });\n        }\n\n        return client.recordEvent({\n          collection: 'form_submissions',\n          event\n        });\n      });\n    }\n\n    if (options.recordPageViews === true && !options.recordPageViewsOnExit) {\n      if (options.catchError) {\n        client\n          .recordEvent({\n            collection: 'pageviews'\n          })\n          .catch(err => {\n            options.catchError(err);\n          });\n      } else {\n        client\n          .recordEvent({\n            collection: 'pageviews'\n          });\n      }\n    }\n\n    if (options.recordPageViewsOnExit && typeof window !== 'undefined') {\n      window.addEventListener('beforeunload', () => {\n        client.config.requestType = 'beaconAPI'; // you can run beforeunload only with beaconAPI\n        client.recordEvent({\n          collection: 'pageviews'\n        });\n      });\n    }\n\n    if(options.recordElementViews === true){\n      if(typeof IntersectionObserver !== 'undefined'){\n        const elementViewsOptions = {\n          threshold: 1.0,\n        }\n        const elementViewsCallback = (events, observer) => {\n          events.forEach(el => {\n            if(el.isIntersecting){\n              const event = {\n                element: helpers.getDomNodeProfile(el.target),\n                local_time_full: new Date().toISOString()\n              }\n              if (options.catchError) {\n                return client\n                  .recordEvent({\n                    collection: 'element_views',\n                    event\n                  }).catch(err => {\n                    options.catchError(err);\n                  });\n              }\n\n              return client\n                .recordEvent({\n                  collection: 'element_views',\n                  event\n                });\n            }\n          })\n        }\n        const observer = new IntersectionObserver(elementViewsCallback, elementViewsOptions);\n        const target = document.querySelectorAll('.track-element-view');\n        target.forEach(el => {\n          observer.observe(el);\n        });\n        client.observers.IntersectionObserver = observer;\n      }\n    }\n\n    return client;\n  };\n}\n\nfunction getSecondsSinceDate(date) {\n  return Math.round(getMiliSecondsSinceDate(date) / 1000);\n}\n\nfunction getMiliSecondsSinceDate(date) {\n  return new Date().getTime() - date.getTime();\n}\n","import Keen from './index';\nimport each from 'keen-core/lib/utils/each';\nimport { queue } from './utils/queue';\n\nexport function deferEvent(eventCollection, eventBody){\n\n  if (arguments.length !== 2 || typeof eventCollection !== 'string') {\n    handleValidationError.call(this, 'Incorrect arguments provided to #deferEvent method');\n    return;\n  }\n\n  this.queue.events[eventCollection] = this.queue.events[eventCollection] || [];\n  this.queue.events[eventCollection].push(eventBody);\n  this.queue.capacity++;\n  if (!this.queue.timer) {\n    this.queue.start();\n  }\n  this.emit('deferEvent', eventCollection, eventBody);\n  return this;\n}\n\nexport function deferEvents(eventsHash){\n  var self = this;\n\n  if (arguments.length !== 1 || typeof eventsHash !== 'object') {\n    handleValidationError.call(this, 'Incorrect arguments provided to #deferEvents method');\n    return;\n  }\n\n  each(eventsHash, function(eventList, eventCollection){\n    self.queue.events[eventCollection] = self.queue.events[eventCollection] || [];\n    self.queue.events[eventCollection] = self.queue.events[eventCollection].concat(eventList);\n    self.queue.capacity = self.queue.capacity + eventList.length;\n    if (!self.queue.timer) {\n      self.queue.start();\n    }\n  });\n  self.emit('deferEvents', eventsHash);\n  return self;\n}\n\nexport function queueCapacity(num){\n  if (!arguments.length) return this.queue.config.capacity;\n  this.queue.config.capacity = num ? Number(num): 0;\n  this.queue.check();\n  return this;\n}\n\nexport function queueInterval(num){\n  if (!arguments.length) return this.queue.config.interval;\n  this.queue.config.interval = num ? Number(num): 0;\n  this.queue.check();\n  return this;\n}\n\nexport function recordDeferredEvents(){\n  const self = this;\n\n  if (self.queue.capacity > 0) {\n    self.queue.pause();\n    let clonedQueueConfig = { ...self.queue.config };\n    let clonedQueueEvents = { ...self.queue.events };\n    self.queue = queue();\n    self.queue.config = clonedQueueConfig;\n    self.queue.on('flush', function(){\n      self.recordDeferredEvents();\n    });\n    self.emit('recordDeferredEvents', clonedQueueEvents);\n    self.recordEvents(clonedQueueEvents, (err, res) => {\n      if (err) {\n        self.emit('recordDeferredEventsError', err, clonedQueueEvents);\n      }\n    });\n  }\n  return self;\n}\n\nfunction handleValidationError(message){\n  this.emit('error', `Event(s) not deferred: ${message}`);\n}\n","import 'promise-polyfill/src/polyfill';\nimport 'whatwg-fetch';\n\nimport md5 from './md5';\n\nimport configDefault from '../config-default.js';\n\nif (typeof self === 'undefined') {\n  console.log('IndexedDB is available only in Browser ENV');\n}\n\nconst indexedDBAvailable = typeof self !== 'undefined' && 'indexedDB' in self;\n\nlet cachingEnabled = true;\n\nif (!indexedDBAvailable) {\n    // console.log(\"Your browser doesn't support a stable version of IndexedDB.\");\n    cachingEnabled = false; // graceful degradation\n}\n\nlet db;\nlet cacheConfig = {\n  ...configDefault.cache\n};\n\nfunction initializeIndexedDb(requestCacheConfig = {}){\n  if (db) { return Promise.resolve(); }\n  if (!cachingEnabled) { return Promise.resolve(); }\n  cacheConfig = {\n    ...cacheConfig,\n    ...requestCacheConfig\n  };\n  return new Promise((resolve, reject) => {\n    const dbConnectionRequest = self.indexedDB.open(cacheConfig.dbName);\n    dbConnectionRequest.onerror = function(event) {\n      cachingEnabled = false;\n      resolve();\n    };\n\n    dbConnectionRequest.onupgradeneeded = function(event) {\n      const db = event.target.result;\n      const objectStore = db\n        .createObjectStore(cacheConfig.dbCollectionName,\n          { keyPath: cacheConfig.dbCollectionKey });\n      objectStore.createIndex(\n        cacheConfig.dbCollectionKey,\n        cacheConfig.dbCollectionKey,\n        { unique: true }\n      );\n      objectStore.createIndex('expiryTime', 'expiryTime', { unique: false });\n    };\n\n    dbConnectionRequest.onsuccess = function(event) {\n      db = event.target.result;\n      db.onerror = function(event) {\n        cachingEnabled = false; // graceful degradation\n      };\n      resolve(db);\n    };\n  });\n}\n\nexport const saveToCache = (hash, configOptions = {}) => {\n  return initializeIndexedDb(configOptions).then(() => {\n    const transactionSave = db\n      .transaction(cacheConfig.dbCollectionName, \"readwrite\")\n      .objectStore(cacheConfig.dbCollectionName);\n    const requestSave = transactionSave.add({\n      hash,\n      expiryTime: Date.now() + cacheConfig.maxAge\n    });\n    requestSave.onsuccess = function(event) {\n    };\n    requestSave.onerror = function(event) {\n      cachingEnabled = false;\n    };\n  });\n}\n\nexport const getFromCache = (hash, configOptions = {}) => {\n  return initializeIndexedDb(configOptions).then(() => {\n    return new Promise((resolve, reject) => {\n      if (!cachingEnabled) {\n        return resolve(null);\n      }\n\n      const transactionCleanUp = db\n        .transaction(cacheConfig.dbCollectionName, \"readwrite\")\n        .objectStore(cacheConfig.dbCollectionName);\n      const indexCleanUp = transactionCleanUp.index('expiryTime');\n      const upperBoundOpenKeyRange = IDBKeyRange.upperBound(Date.now(), true);\n      indexCleanUp.openCursor(upperBoundOpenKeyRange).onsuccess = function(event) {\n        let cursor = event.target.result;\n        if (cursor) {\n          let transactionDelete = db\n            .transaction(cacheConfig.dbCollectionName, \"readwrite\")\n            .objectStore(cacheConfig.dbCollectionName)\n            .delete(event.target.result.value[cacheConfig.dbCollectionKey]);\n          cursor.continue();\n        }\n      };\n\n      const transactionIndex = db\n        .transaction(cacheConfig.dbCollectionName, \"readwrite\")\n        .objectStore(cacheConfig.dbCollectionName);\n      const index = transactionIndex.index(cacheConfig.dbCollectionKey);\n      const responseFromCache = index.get(hash);\n      responseFromCache.onsuccess = function(event) {\n        if (!event.target.result ||\n          event.target.result.expiryTime < Date.now()\n        ) {\n          if (event.target.result && event.target.result.expiryTime < Date.now()){\n            const transactionDelete = db\n              .transaction(cacheConfig.dbCollectionName, \"readwrite\")\n              .objectStore(cacheConfig.dbCollectionName)\n              .delete(event.target.result[cacheConfig.dbCollectionKey]);\n            transactionDelete.onsuccess = (event) => {\n              resolve(getFromCache(hash, configOptions));\n            };\n            transactionDelete.onerror = (event) => {\n              cachingEnabled = false;\n              resolve(getFromCache(hash, configOptions));\n            };\n            return resolve(null);\n          }\n          return resolve(null);\n        } else {\n          return resolve(event.target.result);\n        }\n      };\n      responseFromCache.onerror = function(event) {\n        cachingEnabled = false;\n        resolve(getFromCache(hash, configOptions));\n      };\n    });\n  });\n}\n","import 'promise-polyfill/src/polyfill';\n\nimport md5 from './md5';\nimport { getFromCache, saveToCache } from './cache-browser';\n\nimport configDefault from '../config-default.js';\n\nlet uniqueIds = [];\n\nexport const isUnique = (customCacheConfig, extendedEventBody) => {\n  const configCache = { ...configDefault.cache, ...customCacheConfig.cache };\n  const stringifiedEvent = JSON.stringify(extendedEventBody);\n  const { hashingMethod } = configCache;\n  const hash = hashingMethod && hashingMethod.toLowerCase() === 'md5'\n    ? md5(stringifiedEvent) : stringifiedEvent;\n  const expiryTime = configCache.maxAge ? (Date.now() + configCache.maxAge) : undefined;\n  const item = {\n    hash,\n    expiryTime\n  };\n  if (expiryTime){\n    const now = Date.now();\n    uniqueIds = uniqueIds.filter(item => item.expiryTime > now);\n  }\n\n  const alreadySentEvent = uniqueIds.find(item => item.hash === hash);\n  if (alreadySentEvent) {\n    if (alreadySentEvent.expiryTime && alreadySentEvent.expiryTime < Date.now()) {\n      uniqueIds = uniqueIds.filter(item => item.hash !== hash);\n    } else {\n      return Promise.resolve(false);\n    }\n  }\n  uniqueIds.push(item);\n  if (configCache.storage && configCache.storage.toLowerCase() === 'indexeddb') {\n    return getFromCache(hash, configCache).then(alreadySentEvent => {\n      if (alreadySentEvent) {\n        return false;\n      }\n      saveToCache(hash, configCache);\n      return true;\n    });\n  }\n\n  return Promise.resolve(true);\n}\n\nexport default isUnique;\n","export default {\n    REQUEST_ABORTED: 'REQUEST_ABORTED'\n}\n","import 'promise-polyfill/src/polyfill';\nimport 'whatwg-fetch';\n\nimport configDefault from '../config-default.js';\nimport Constants from '../constants.js';\n\nexport default function(url, options) {\n  const config = {\n    ...configDefault,\n    ...(options.retry || {})\n  };\n\n  const retriesLimit = config.retry.limit;\n  const retryInitialDelay = config.retry.initialDelay;\n  const retryOn = config.retry.retryOnResponseStatuses;\n  let retriesCount = 0;\n\n  if (retryOn && !(retryOn instanceof Array)) {\n    throw {\n      name: 'ArgumentError',\n      message: 'retryOn property expects an array'\n    }\n  }\n  let abortController;\n  if (typeof AbortController !== 'undefined') {\n    abortController = new AbortController();\n  }\n\n  const promiseWithAbort = new Promise(function(resolve, reject) {\n    const wrappedFetch = function(n) {\n      fetch(url, {...options, signal: abortController.signal})\n        .then(function(response) {\n          if (retryOn.indexOf(response.status) === -1) {\n            resolve(response);\n          } else {\n            if (n > 0) {\n              retry();\n            } else {\n              reject(response);\n            }\n          }\n        })\n        .catch(function(error) {\n          if(error.code === DOMException.ABORT_ERR) {\n            return reject(Constants.REQUEST_ABORTED);\n          }\n          if (n > 0) {\n            retry();\n          } else {\n            reject(error);\n          }\n        });\n    };\n\n    function retry() {\n      retriesCount = retriesCount + 1;\n      setTimeout(function() {\n          wrappedFetch(retriesLimit - retriesCount);\n        }, 2^retriesCount * retryInitialDelay);\n    }\n\n    wrappedFetch(retriesLimit - retriesCount);\n  });\n\n  promiseWithAbort.abort = () => {\n      abortController.abort();\n  }\n\n  return promiseWithAbort;\n};\n","module.exports = {\n  map: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n  encode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, i1, i2, i3, e1, e2, e3, e4;\n    n = this.utf8.encode(n);\n    while (i < n.length) {\n      i1 = n.charCodeAt(i++); i2 = n.charCodeAt(i++); i3 = n.charCodeAt(i++);\n      e1 = (i1 >> 2); e2 = (((i1 & 3) << 4) | (i2 >> 4)); e3 = (isNaN(i2) ? 64 : ((i2 & 15) << 2) | (i3 >> 6));\n      e4 = (isNaN(i2) || isNaN(i3)) ? 64 : i3 & 63;\n      o = o + m.charAt(e1) + m.charAt(e2) + m.charAt(e3) + m.charAt(e4);\n    } return o;\n  },\n  decode: function (n) {\n    \"use strict\";\n    var o = \"\", i = 0, m = this.map, cc = String.fromCharCode, e1, e2, e3, e4, c1, c2, c3;\n    n = n.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n    while (i < n.length) {\n      e1 = m.indexOf(n.charAt(i++)); e2 = m.indexOf(n.charAt(i++));\n      e3 = m.indexOf(n.charAt(i++)); e4 = m.indexOf(n.charAt(i++));\n      c1 = (e1 << 2) | (e2 >> 4); c2 = ((e2 & 15) << 4) | (e3 >> 2);\n      c3 = ((e3 & 3) << 6) | e4;\n      o = o + (cc(c1) + ((e3 != 64) ? cc(c2) : \"\")) + (((e4 != 64) ? cc(c3) : \"\"));\n    } return this.utf8.decode(o);\n  },\n  utf8: {\n    encode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i++); o = o + ((c < 128) ? cc(c) : ((c > 127) && (c < 2048)) ?\n        (cc((c >> 6) | 192) + cc((c & 63) | 128)) : (cc((c >> 12) | 224) + cc(((c >> 6) & 63) | 128) + cc((c & 63) | 128)));\n        } return o;\n    },\n    decode: function (n) {\n      \"use strict\";\n      var o = \"\", i = 0, cc = String.fromCharCode, c2, c;\n      while (i < n.length) {\n        c = n.charCodeAt(i);\n        o = o + ((c < 128) ? [cc(c), i++][0] : ((c > 191) && (c < 224)) ?\n        [cc(((c & 31) << 6) | ((c2 = n.charCodeAt(i + 1)) & 63)), (i += 2)][0] :\n        [cc(((c & 15) << 12) | (((c2 = n.charCodeAt(i + 1)) & 63) << 6) | ((c3 = n.charCodeAt(i + 2)) & 63)), (i += 3)][0]);\n      } return o;\n    }\n  }\n};\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","import 'promise-polyfill/src/polyfill';\nimport 'whatwg-fetch';\n\nimport base64 from 'keen-core/lib/utils/base64';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\n\nimport Keen from './index';\nimport {version} from '../package.json';\n\nimport {getExtendedEventBody} from './extend-events';\nimport fetchRetry from './utils/fetchRetry';\nimport isUnique from './utils/unique';\n\n// ------------------------------\n// .recordEvent\n// ------------------------------\n\nexport function recordEvent(eventCollectionOrConfigObject, eventBody, callback) {\n    let eventCollection = eventCollectionOrConfigObject;\n    let useBeaconApi = false;\n    let unique;\n    let configObject;\n    let clientConfig = this.config;\n\n    if (typeof eventCollectionOrConfigObject === 'object'\n        && eventCollectionOrConfigObject) {\n        // slowly but surely we migrate to one object with all args\n        configObject = eventCollectionOrConfigObject;\n        eventCollection = eventCollectionOrConfigObject.collection\n            || eventCollectionOrConfigObject.event_collection;\n        eventBody = eventCollectionOrConfigObject.event;\n        callback = eventCollectionOrConfigObject.callback;\n        unique = eventCollectionOrConfigObject.unique;\n    }\n\n    const url = this.url('events', encodeURIComponent(eventCollection));\n    let data = {};\n\n    if (!checkValidation.call(this, callback)) {\n        return;\n    }\n\n    if (!eventCollection || typeof eventCollection !== 'string') {\n        handleValidationError.call(this, 'Collection name must be a string.', callback);\n        return;\n    }\n\n    extend(data, eventBody);\n\n    // ------------------------------\n    // Run extendEvent(s) transforms\n    // ------------------------------\n    const extendedEventsHash = {};\n    getExtendedEventBody(extendedEventsHash, this.extensions.events);\n    getExtendedEventBody(extendedEventsHash, this.extensions.collections[eventCollection]);\n    getExtendedEventBody(extendedEventsHash, [data]);\n\n    if (unique) {\n        return isUnique(configObject, extendedEventsHash).then(isUniqueResult => {\n            if (!isUniqueResult) {\n                return Promise.resolve({\n                    created: false,\n                    message: '[NOT_UNIQUE] This event has already been recorded'\n                });\n            }\n            return recordEvent.call(this, {...eventCollectionOrConfigObject, unique: undefined});\n        });\n    }\n\n    this.emit('recordEvent', eventCollection, extendedEventsHash);\n\n    if (!Keen.enabled) {\n        handleValidationError.call(this, 'Keen.enabled is set to false.', callback);\n        return false;\n    }\n\n    if (Keen.optedOut) {\n        return Promise.resolve({\n            created: false,\n            message: 'Keen.optedOut is set to true.'\n        })\n    }\n\n    if (Keen.doNotTrack) {\n        return Promise.resolve({\n            created: false,\n            message: 'Keen.doNotTrack is set to true.'\n        })\n    }\n\n    return send.call(this, {url, extendedEventsHash, callback, configObject, eventCollection});\n}\n\n// ------------------------------\n// .recordEvents\n// ------------------------------\n\nexport function recordEvents(eventsHash, callback) {\n    const self = this;\n    const url = this.url('events');\n\n    if (!checkValidation.call(this, callback)) {\n        return;\n    }\n\n    if ('object' !== typeof eventsHash || eventsHash instanceof Array) {\n        handleValidationError.call(this, 'First argument must be an object', callback);\n        return;\n    }\n\n    if (arguments.length > 2) {\n        handleValidationError.call(this, 'Incorrect arguments provided to #recordEvents method', callback);\n        return;\n    }\n\n    // ------------------------------\n    // Run extendEvent(s) transforms\n    // ------------------------------\n    const extendedEventsHash = {};\n    each(eventsHash, function (eventList, eventCollection) {\n        // Find or create collection on new hash\n        extendedEventsHash[eventCollection] = extendedEventsHash[eventCollection] || [];\n        // Loop over each eventBody in the existing hash\n        each(eventList, function (eventBody, index) {\n            // Create a new data object\n            let extendedEventBody = {};\n            // Process \"events\" transform pipeline\n            getExtendedEventBody(extendedEventBody, self.extensions.events);\n            // Process \"collection\" transform pipeline\n            getExtendedEventBody(extendedEventBody, self.extensions.collections[eventCollection]);\n            // Blend existing eventBody data into the result\n            getExtendedEventBody(extendedEventBody, [eventBody]);\n            // Push extendedEventBody into new hash\n            extendedEventsHash[eventCollection].push(extendedEventBody);\n        });\n    });\n\n    this.emit('recordEvents', extendedEventsHash);\n\n    if (!Keen.enabled) {\n        handleValidationError.call(this, 'Keen.enabled is set to false.', callback);\n        return false;\n    }\n\n    if (Keen.optedOut) {\n        return Promise.resolve({\n            created: false,\n            message: 'Keen.optedOut is set to true.'\n        })\n    }\n\n    if (Keen.doNotTrack) {\n        return Promise.resolve({\n            created: false,\n            message: 'Keen.doNotTrack is set to true.'\n        })\n    }\n\n    return send.call(this, {url, extendedEventsHash, callback});\n}\n\nfunction send({url, extendedEventsHash, callback, configObject = {}, eventCollection}) {\n    const clientConfig = this.config;\n    const requestType = configObject.requestType // specific method for one request\n        || this.config.requestType; // global request type of client\n\n    if (\n        navigator && navigator.sendBeacon &&\n        requestType === 'beaconAPI'\n        // so you can send specific recordEvent() using beaconAPI\n        // even if your global client's config prefers Fetch\n    ) {\n        navigator.sendBeacon(\n            `${url}?api_key=${this.writeKey()}`,\n            JSON.stringify(extendedEventsHash)\n        );\n        if (callback) {\n            // Beacon API is not handling responses nor errors\n            callback();\n        }\n        return this;\n    }\n\n    // this is IMAGE beacon, not the Beacon API. deprecated\n    if (requestType === 'beacon' || requestType === 'img') {\n        const getRequestUrl = this.url('events', encodeURIComponent(eventCollection), {\n            api_key: this.writeKey(),\n            data: encodeURIComponent(base64.encode(JSON.stringify(extendedEventsHash))),\n            modified: new Date().getTime()\n        });\n        const getRequestUrlOkLength = getRequestUrl.length < getUrlMaxLength();\n\n        if (getRequestUrlOkLength) {\n            sendBeacon.call(this, getRequestUrl, callback);\n        } else {\n            if (callback) {\n                callback('Beacon URL length exceeds current browser limit, and XHR is not supported.', null);\n            }\n        }\n        return this;\n    }\n\n    if (typeof fetch !== 'undefined') {\n        return sendFetch.call(this, 'POST', url, extendedEventsHash, callback);\n    }\n\n    return this;\n}\n\nfunction sendFetch(method, url, data, callback = undefined) {\n    const self = this;\n\n    const fetch = fetchRetry(url, {\n        method,\n        body: data ? JSON.stringify(data) : '',\n        mode: 'cors',\n        redirect: 'follow',\n        referrerPolicy: self.referrerPolicy() || 'unsafe-url',\n        headers: {\n            'Authorization': self.writeKey(),\n            'Content-Type': 'application/json',\n            'keen-sdk': `javascript-${version}`\n        },\n        // keepalive: true, not supported for CORS yet\n        retry: self.config.retry\n    });\n\n    fetch.catch(connectionError => {\n        if (typeof callback !== 'undefined') {\n            callback.call(self, connectionError, null);\n        }\n        self.emit('error', connectionError);\n        return Promise.reject(connectionError);\n    })\n        .then(response => {\n            if (response.ok) {\n                return response.json();\n            }\n\n            return response.json().then(responseJSON => {\n                return Promise.reject({\n                    error_code: responseJSON.error_code,\n                    body: responseJSON.message,\n                    status: response.status,\n                    ok: false,\n                    statusText: response.statusText\n                });\n            });\n        }).then(responseJSON => {\n        const eventsSavedSuccessfuly = checkEventsSavedSuccessfuly(responseJSON);\n        if (eventsSavedSuccessfuly) {\n            if (typeof callback !== 'undefined') {\n                callback.call(self, null, responseJSON);\n            }\n            return Promise.resolve(responseJSON);\n        } else {\n            if (typeof callback !== 'undefined') {\n                callback.call(self, responseJSON, null);\n            }\n            self.emit('error', responseJSON);\n            return Promise.reject(responseJSON);\n        }\n    });\n\n    return fetch;\n}\n\nfunction checkEventsSavedSuccessfuly(response) {\n    // single event\n    if (typeof response.created !== 'undefined') {\n        if (response.created) {\n            return true;\n        }\n        return false;\n    }\n    // multiple events\n    const responseKeys = Object.keys(response);\n    const notSavedEvents = responseKeys\n        .map(collection => {\n            return response[collection].filter(event => !event.success);\n        })\n        .filter(collection => collection.length > 0);\n\n    if (notSavedEvents.length === 0) {\n        return true;\n    }\n\n    return false;\n}\n\n// Validation\nfunction checkValidation(callback) {\n\n    if (!this.projectId()) {\n        handleValidationError.call(this, 'Keen.Client is missing a projectId property.', callback);\n        return false;\n    }\n    if (!this.writeKey()) {\n        handleValidationError.call(this, 'Keen.Client is missing a writeKey property.', callback);\n        return false;\n    }\n    return true;\n}\n\nfunction handleValidationError(message, callback) {\n    const err = `Event(s) not recorded: ${message}`;\n    this.emit('error', err);\n    if (callback) {\n        callback.call(this, err, null);\n    }\n}\n\nfunction getUrlMaxLength() {\n    if ('undefined' !== typeof window && navigator) {\n        if (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > 0) {\n            return 1900;\n        }\n    }\n    return 16000;\n}\n\n/*\n  DEPRECATED METHODS\n*/\n\n// Image Beacon Requests\n// DEPRECATED\nfunction sendBeacon(url, callback) {\n    var self = this,\n        img = document.createElement('img'),\n        loaded = false;\n\n    img.onload = function () {\n        loaded = true;\n        if ('naturalHeight' in this) {\n            if (this.naturalHeight + this.naturalWidth === 0) {\n                this.onerror();\n                return;\n            }\n        } else if (this.width + this.height === 0) {\n            this.onerror();\n            return;\n        }\n        if (callback) {\n            callback.call(self);\n        }\n    };\n    img.onerror = function () {\n        loaded = true;\n        if (callback) {\n            callback.call(self, 'An error occurred!', null);\n        }\n    };\n    img.src = url + '&c=clv1';\n}\n","import Emitter from 'component-emitter';\nimport each from 'keen-core/lib/utils/each';\n/*\n\n  // Create a new element listner\n  var myClickerCatcher = Keen.utils.listener(\".nav li > a\");\n\n  // Listen for a given event\n  myClicker.on(\"click\", function(e){\n    // do stuff!\n  });\n\n  // Listen for event once\n  myClicker.once(\"click\", function(e){ });\n\n  // Cancel a given event listener\n  myClicker.off(\"click\");\n\n  // Cancel all event listners\n  myClicker.off();\n\n*/\n\nexport const listenerCore = function(ctx){\n\n  // Make sure this object exists\n  ctx.domListeners = ctx.domListeners || {\n    /*\n    'click': {\n      '.nav li > a': [fn, fn, fn]\n    }\n    */\n  };\n\n  function listener(str){\n    if (!str) return;\n    if (this instanceof listener === false) {\n      return new listener(str);\n    }\n    this.selector = str;\n    return this;\n  }\n\n  listener.prototype.on = function(str, fn){\n    var self = this;\n\n    if (arguments.length !== 2 || 'string' !== typeof str || 'function' !== typeof fn) return this;\n\n    // Set each listener on a parent dictionary, indexed by event:\n    if ('undefined' === typeof ctx.domListeners[str]) {\n      addListener(str, eventHandler(str));\n      ctx.domListeners[str] = {};\n    }\n    ctx.domListeners[str][self.selector] = ctx.domListeners[str][self.selector] || [];\n    ctx.domListeners[str][self.selector].push(fn);\n    return self;\n  };\n\n  listener.prototype.once = function(str, fn){\n    var self = this;\n    function on() {\n      self.off(str, on);\n      return fn.apply(self, arguments);\n    }\n    on.fn = fn;\n    self.on(str, on);\n    return self;\n  };\n\n  listener.prototype.off = function(str, fn){\n    var self = this, survivors = [];\n    if (arguments.length === 2) {\n      each(ctx.domListeners[str][self.selector], function(handler, i){\n        if (handler === fn || handler.fn === fn) return;\n        survivors.push(handler);\n      });\n      ctx.domListeners[str][self.selector] = survivors;\n    }\n    else if (arguments.length === 1) {\n      try {\n        delete ctx.domListeners[str][self.selector];\n      }\n      catch(e){\n        ctx.domListeners[str][self.selector] = [];\n      }\n    }\n    else {\n      // loop over every eventType and delete handlers\n      each(ctx.domListeners, function(hash, eventType){\n        // if ('undefined' === typeof hash[str]) return;\n        try {\n          delete ctx.domListeners[eventType][self.selector];\n        }\n        catch(e){\n          ctx.domListeners[eventType][self.selector] = function(){};\n        }\n      });\n    }\n    return self;\n  };\n\n  function eventHandler(eventType){\n    return function(e){\n      var evt, target;\n\n      evt = e || window.event;\n      target = evt.target || evt.srcElement;\n\n      // If nothing assigned to this event type, let it go\n      if ('undefined' === ctx.domListeners[eventType]) return;\n\n      each(ctx.domListeners[eventType], function(handlers, key){\n\n        if (matches(target, key)) {\n          // Call all handlers for this eventType + node\n          each(handlers, function(fn, i){\n            if ('click' === eventType && 'A' === target.nodeName) {\n              deferClickEvent(evt, target, fn);\n            }\n            else if ('submit' === eventType && 'FORM' === target.nodeName) {\n              deferFormSubmit(evt, target, fn);\n            }\n            else {\n              fn(evt);\n            }\n          });\n        }\n        else if ('window' === key) {\n          // Call all handlers\n          each(handlers, function(fn, i){\n            fn(evt);\n          });\n        }\n        return;\n      });\n    };\n  }\n\n  return listener;\n}\n\n\n// ------------------------------\n// Attach global event listener\n// ------------------------------\n\nfunction addListener(eventType, fn){\n  if (document.addEventListener) {\n    document.addEventListener(eventType, fn, false);\n  } else {\n    document.attachEvent(\"on\" + eventType, fn);\n  }\n}\n\n\n// ------------------------------\n// Match DOM element to selector\n// ------------------------------\n\nfunction matches(elem, selector) {\n  // We'll use querySelectorAll to find all element matching the selector,\n  // then check if the given element is included in that list.\n  // Executing the query on the parentNode reduces the resulting nodeList,\n  // document doesn't have a parentNode, though.\n  var nodeList = ( elem.parentNode || document ).querySelectorAll( selector ) || [],\n      i = nodeList.length;\n\n  // loop on the nodeList\n  while ( i-- ) {\n    if ( nodeList[i] == elem ) { return true; }\n  }\n  return false;\n}\n\n\n// ------------------------------\n// Handle 'click' events (A)\n// ------------------------------\n\nfunction deferClickEvent(evt, anchor, callback){\n  var timeout = 500,\n      targetAttr,\n      cbResponse;\n\n  // Get 'target' attribute from anchor\n  if (anchor.getAttribute !== void 0) {\n    targetAttr = anchor.getAttribute(\"target\");\n  } else if (anchor.target) {\n    targetAttr = anchor.target;\n  }\n\n  // Fire listener and catch possible response (return false)\n  cbResponse = callback(evt);\n\n  // If prevented within callback, bail:\n  if (('boolean' === typeof cbResponse && cbResponse === false) || evt.defaultPrevented || evt.returnValue === false) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    return false;\n  }\n  // Else if anchor doesn't kick off a new window or tab.. defer and replay the event:\n  else if (targetAttr !== '_blank' && targetAttr !== 'blank' && !evt.metaKey && !anchor.hasAttribute('download')) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    if (\n      anchor.href\n      && anchor.href !== '#'\n      && anchor.href !== (window.location + '#')\n    ) {\n      if (typeof cbResponse !== 'undefined') {\n        if (navigator && navigator.sendBeacon) {\n          window.location = anchor.href;\n          return;\n        }\n        // promise\n        cbResponse.then(() => {\n          window.location = anchor.href;\n        }).catch(err => {\n          // change location anyway - to not let user hanging\n          window.location = anchor.href;\n        });\n      } else {\n        setTimeout(function(){\n          window.location = anchor.href;\n        }, timeout);\n      }\n    }\n  }\n\n  return false;\n}\n\n\n// ------------------------------\n// Handle 'submit' events (FORM)\n// ------------------------------\n\nfunction deferFormSubmit(evt, form, callback){\n  var timeout = 500;\n  // Fire listener and catch possible response (return false)\n  var cbResponse = callback(evt);\n\n  // If prevented within callback, bail\n  if (('boolean' === typeof cbResponse && cbResponse === false) || evt.defaultPrevented || evt.returnValue === false) {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    return false;\n  }\n  // Defer and replay event\n  else {\n    if (evt.preventDefault) {\n      evt.preventDefault();\n    }\n    evt.returnValue = false;\n    if (typeof cbResponse !== 'undefined') {\n      if (navigator && navigator.sendBeacon) {\n        form.submit();\n        return;\n      }\n      // promise\n      cbResponse.then(() => {\n        form.submit();\n      }).catch(err => {\n        // submit form anyway - to not let user hanging\n        form.submit();\n      });\n    } else {\n      setTimeout(function(){\n        form.submit();\n      }, timeout);\n    }\n  }\n\n  return false;\n}\n","var each = require('./each'),\n    extend = require('./extend');\n\nmodule.exports = serialize;\n\nfunction serialize(data){\n  var query = [];\n  each(data, function(value, key){\n    if ('string' !== typeof value) {\n      value = JSON.stringify(value);\n    }\n    query.push(key + '=' + encodeURIComponent(value));\n  });\n  return query.join('&');\n}\n","module.exports = parseParams;\n\nfunction parseParams(str){\n  // via: http://stackoverflow.com/a/2880929/2511985\n  var urlParams = {},\n      match,\n      pl     = /\\+/g,  // Regex for replacing addition symbol with a space\n      search = /([^&=]+)=?([^&]*)/g,\n      decode = function (s) { return decodeURIComponent(s.replace(pl, \" \")); },\n      query  = str.split(\"?\")[1];\n\n  while (!!(match=search.exec(query))) {\n    urlParams[decode(match[1])] = decode(match[2]);\n  }\n  return urlParams;\n};\n","(function(env){\n  var previousKeen = env.Keen || undefined;\n  var each = require('./utils/each'),\n      extend = require('./utils/extend'),\n      parseParams = require('./utils/parse-params'),\n      serialize = require('./utils/serialize');\n\n  var Emitter = require('component-emitter');\n\n  function Client(props){\n    if (this instanceof Client === false) {\n      return new Client(props);\n    }\n    this.configure(props);\n\n    // Set up event handling\n    if (Client.debug) {\n      this.on('error', Client.log);\n    }\n    this.emit('ready');\n    Client.emit('client', this);\n  }\n\n  if (previousKeen && typeof previousKeen.resources === 'undefined') {\n    Client.legacyVersion = previousKeen;\n  }\n\n  Emitter(Client);\n  Emitter(Client.prototype);\n\n  extend(Client, {\n    debug: false,\n    enabled: true,\n    loaded: false,\n    version: '__VERSION__'\n  });\n\n  // Set or extend helpers\n  Client.helpers = Client.helpers || {};\n\n  // Set or extend resources\n  Client.resources = Client.resources || {};\n  extend(Client.resources, {\n    'base'      : '{protocol}://{host}',\n    'version'   : '{protocol}://{host}/3.0',\n    'projects'  : '{protocol}://{host}/3.0/projects',\n    'projectId' : '{protocol}://{host}/3.0/projects/{projectId}',\n    'events'    : '{protocol}://{host}/3.0/projects/{projectId}/events',\n    'queries'   : '{protocol}://{host}/3.0/projects/{projectId}/queries'\n  });\n\n  // Set or extend utils\n  Client.utils = Client.utils || {};\n  extend(Client.utils, {\n    'each'        : each,\n    'extend'      : extend,\n    'parseParams' : parseParams,\n    'serialize'   : serialize\n  });\n\n  Client.extendLibrary = function(target, source) {\n    var previous = previousKeen || source;\n    if (isDefined(previous) && isDefined(previous.resources)) {\n      each(previous, function(value, key) {\n        if (typeof value === 'object') {\n          target[key] = target[key] || {};\n          extend(target[key], value);\n        }\n        else {\n          target[key] = target[key] || value;\n        }\n      });\n      extend(target.prototype, previous.prototype);\n    }\n    return target;\n  };\n\n  Client.log = function(str){\n    if (Client.debug && typeof console === 'object') {\n      console.log('[Keen]', str);\n    }\n  };\n\n  Client.noConflict = function(){\n    if (typeof env.Keen !== 'undefined') {\n      env.Keen = Client.legacyVersion || previousKeen;\n    }\n    return Client;\n  };\n\n  Client.ready = function(fn){\n    if (Client.loaded) {\n      fn();\n    }\n    else {\n      Client.once('ready', fn);\n    }\n  };\n\n  Client.prototype.configure = function(obj){\n    var config = obj || {};\n    this.config = this.config || {\n      projectId    : undefined,\n      writeKey     : undefined,\n      host         : 'api.keen.io',\n      protocol     : 'https',\n      requestType  : 'jsonp',\n      resources    : extend({}, Client.resources)\n    };\n\n    // IE<10 request shim\n    if (typeof window !== 'undefined' && window.navigator && window.navigator.userAgent && window.navigator.userAgent.indexOf('MSIE') > -1) {\n      config.protocol = document.location.protocol.replace(':', '');\n    }\n\n    if (config.host) {\n      config.host.replace(/.*?:\\/\\//g, '');\n    }\n\n    extend(this.config, config);\n    return this;\n  };\n\n  Client.prototype.masterKey = function(str){\n    if (!arguments.length) return this.config.masterKey;\n    this.config.masterKey = str ? String(str) : null;\n    return this;\n  };\n\n  Client.prototype.projectId = function(str){\n    if (!arguments.length) return this.config.projectId;\n    this.config.projectId = (str ? String(str) : null);\n    return this;\n  };\n\n  Client.prototype.resources = function(obj){\n    if (!arguments.length) return this.config.resources;\n    var self = this;\n    if (typeof obj === 'object') {\n      each(obj, function(value, key){\n        self.config.resources[key] = (value ? value : null);\n      });\n    }\n    return self;\n  };\n\n  Client.prototype.url = function(name){\n    var args = Array.prototype.slice.call(arguments, 1),\n        baseUrl = this.config.resources.base || '{protocol}://{host}',\n        path;\n\n    if (name && typeof name === 'string') {\n      if (this.config.resources[name]) {\n        path = this.config.resources[name];\n      }\n      else {\n        path = baseUrl + name;\n      }\n    }\n    else {\n      path = baseUrl;\n    }\n\n    each(this.config, function(value, key){\n      if (typeof value !== 'object') {\n        path = path.replace('{' + key + '}', value);\n      }\n    });\n\n    each(args, function(arg, i){\n      if (typeof arg === 'string') {\n        path += '/' + arg;\n      }\n      else if (typeof arg === 'object') {\n        path += '?';\n        each(arg, function(value, key){\n          path += key + '=' + value + '&';\n        });\n        path = path.slice(0, -1);\n      }\n    });\n\n    return path;\n  };\n\n  domReady(function(){\n    Client.loaded = true;\n    Client.emit('ready');\n  });\n\n  function domReady(fn){\n    if (Client.loaded || typeof document === 'undefined') {\n      fn();\n      return;\n    }\n    // Firefox 3.5 shim\n    if(document.readyState == null && document.addEventListener){\n      document.addEventListener('DOMContentLoaded', function DOMContentLoaded(){\n        document.removeEventListener('DOMContentLoaded', DOMContentLoaded, false);\n        document.readyState = 'complete';\n      }, false);\n      document.readyState = 'loading';\n    }\n    testDom(fn);\n  }\n\n  function testDom(fn){\n    if (/in/.test(document.readyState)) {\n      setTimeout(function(){\n        testDom(fn);\n      }, 9);\n    }\n    else {\n      fn();\n    }\n  }\n\n  function isDefined(target) {\n    return typeof target !== 'undefined';\n  }\n\n  function isUndefined(target) {\n    return typeof target === 'undefined';\n  }\n\n  module.exports = Client;\n\n}).call(this, typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {});\n","import KeenCore from './index';\nimport each from 'keen-core/lib/utils/each';\nimport extend from 'keen-core/lib/utils/extend';\nimport { listenerCore } from './utils/listener';\nimport {\n  recordEvent,\n  recordEvents\n} from './record-events-browser';\nimport {\n  deferEvent,\n  deferEvents,\n  queueCapacity,\n  queueInterval,\n  recordDeferredEvents\n} from './defer-events';\nimport { extendEvent, extendEvents } from './extend-events';\nimport { initAutoTrackingCore } from './browser-auto-tracking';\nimport { getBrowserProfile } from './helpers/getBrowserProfile';\nimport { getDatetimeIndex } from './helpers/getDatetimeIndex';\nimport { getDomainName } from './helpers/getDomainName';\nimport { getDomNodePath } from './helpers/getDomNodePath';\nimport { getDomNodeProfile } from './helpers/getDomNodeProfile';\nimport { getScreenProfile } from './helpers/getScreenProfile';\nimport { getScrollState } from './helpers/getScrollState';\nimport { getUniqueId } from './helpers/getUniqueId';\nimport { getWindowProfile } from './helpers/getWindowProfile';\nimport { cookie } from './utils/cookie';\nimport { deepExtend } from './utils/deepExtend';\nimport { serializeForm } from './utils/serializeForm';\nimport { timer } from './utils/timer';\nimport { setOptOut } from './utils/optOut';\nimport { isLocalStorageAvailable } from './utils/localStorage';\n\n// ------------------------\n// Methods\n// ------------------------\nextend(KeenCore.prototype, {\n  recordEvent,\n  recordEvents\n});\n\nextend(KeenCore.prototype, {\n  deferEvent,\n  deferEvents,\n  queueCapacity,\n  queueInterval,\n  recordDeferredEvents,\n  setOptOut\n});\nextend(KeenCore.prototype, {\n  extendEvent,\n  extendEvents\n});\n\n// ------------------------\n// Auto-Tracking\n// ------------------------\nconst initAutoTracking = initAutoTrackingCore(KeenCore);\nextend(KeenCore.prototype, {\n  initAutoTracking\n});\n\n// ------------------------\n// Helpers\n// ------------------------\nextend(KeenCore.helpers, {\n  getBrowserProfile,\n  getDatetimeIndex,\n  getDomainName,\n  getDomNodePath,\n  getDomNodeProfile,\n  getScreenProfile,\n  getScrollState,\n  getUniqueId,\n  getWindowProfile\n});\n\n// ------------------------\n// Utils\n// ------------------------\nconst listener = listenerCore(KeenCore);\nextend(KeenCore.utils, {\n  cookie,\n  deepExtend,\n  listener,\n  serializeForm,\n  timer\n});\n\nKeenCore.listenTo = (listenerHash) => {\n  each(listenerHash, (callback, key) => {\n    let split = key.split(' ');\n    let eventType = split[0],\n    selector = split.slice(1, split.length).join(' ');\n    // Create an unassigned listener\n    return listener(selector).on(eventType, callback);\n  });\n};\n\nexport let keenGlobals = undefined;\nif (typeof webpackKeenGlobals !== 'undefined') {\n  keenGlobals = webpackKeenGlobals;\n}\n\nif (isLocalStorageAvailable && localStorage.getItem('optout')) {\n  KeenCore.optedOut = true;\n}\n\nif (navigator.doNotTrack === '1'\n  || navigator.doNotTrack === 'yes') {\n  KeenCore.doNotTrack = true;\n}\n\nexport const Keen = KeenCore.extendLibrary(KeenCore); // deprecated, left for backward compatibility\nexport const KeenTracking = Keen;\nexport default Keen;\n"],"sourceRoot":""}